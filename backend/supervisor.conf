[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

; ============================================
; Node.js Backend API (Main service on port 7860)
; ============================================
[program:nodejs-api]
command=node /app/api/server.js
directory=/app/api
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/supervisor/nodejs-api.err.log
stdout_logfile=/var/log/supervisor/nodejs-api.out.log
environment=NODE_ENV="production",PORT="7860"
priority=100

; ============================================
; Python OCR Service (Internal port 8000)
; ============================================
[program:ocr-service]
command=/opt/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000
directory=/app/ocr
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/supervisor/ocr-service.err.log
stdout_logfile=/var/log/supervisor/ocr-service.out.log
environment=PYTHONPATH="/app/ocr"
priority=200

; ============================================
; Python ML Revenue Leakage Service (Internal port 5002)
; ============================================
[program:ml-revenue]
command=/opt/venv/bin/uvicorn app:app --host 0.0.0.0 --port 5002
directory=/app/ml/revenue_leakage
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/supervisor/ml-revenue.err.log
stdout_logfile=/var/log/supervisor/ml-revenue.out.log
environment=PYTHONPATH="/app/ml"
priority=300

; ============================================
; Python ML Predictive Analytics Service (Internal port 5003)
; ============================================
[program:ml-predict]
command=/opt/venv/bin/uvicorn app:app --host 0.0.0.0 --port 5003
directory=/app/ml/predictive_analytics
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/supervisor/ml-predict.err.log
stdout_logfile=/var/log/supervisor/ml-predict.out.log
environment=PYTHONPATH="/app/ml"
priority=300
